---
title: "School data file vignette"
author: "John Merrall"
date: "11/11/2019"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{2016 Hamilton public board primary schools data file}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2016 Hamilton public board primary schools data file

---
```{r}
#setwd("C:/Users/me/Documents/GitHub/SchoolProbit/sess7r/")
```

```{r}
library(sess7r)
library(ggplot2)
library(tmap)
```


This datafile is a collection of information on 2016 primary schools in the Hamilton public school board.

Let's see the header:

```{r}
head(publicschools2016primary)
```

As you can see, it contains school names, co-ordinates (in NAD83 UTM Zone 17N), addresses, a "year built" column that contains the HWDSB's estimate of the year the school was built, a "SchoolID" that is assigned by the board, and some geometry.

Not much data in this, but we could look at the distribution of Year_Built. Let's first create a new column "School_Age", which is just the present year minus Year_Built:

```{r}
publicschools2016primary$School_Age <- 2019 - publicschools2016primary$Year_Built
```

Now we can plot the distribution of school age, let's say by whether or not the school is in Hamilton:

```{r}
a <- ggplot(publicschools2016primary, aes(x = School_Age))
a + geom_density(aes(color = as.factor(City != "Hamilton"))) + theme(legend.position="bottom")
```

As you can see, schools built before 1900 are almost exclusively in Hamilton - though there are a couple outside of the city that are recorded as having an old age. Note, though, that Tapleytown, one of the rural schools listed as being old, has an incorrect age assigned to it by the Board: what they're really measuring is the age of the old one-room schoolhouse that has been preserved as part of the newer school. Thus, the ages in this file are not necessarily to be trusted!

You can also see a large hump in school construction that occurred approximately 50-70 years ago, i.e. during the baby boom. It's also visible in a histogram:


```{r}
b <- ggplot(publicschools2016primary, aes(x = School_Age))
b + geom_histogram()
```

The hump in the 50-70 year range, being more pronounced in the urban density curve, indicates that the baby boom primarily occurred in the urban core, not in the peripheral towns.

You can also see where the schools are located, by age, with a tmap:

```{r}
tmap_mode("view")
tm_shape(publicschools2016primary) + tm_dots("School_Age")
```

Obviously, the South Mountain has seen a lot of new schools built in the past few decades; however, the downtown core has also seen a large amount of capital renewal in schools.

